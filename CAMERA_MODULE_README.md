# 相机模块使用说明

## 功能概述

本相机模块为水工日志应用提供了完整的拍照和录像功能，支持按项目和日期自动组织媒体文件。

## 主要功能

### 1. 项目媒体目录管理
- 自动为每个项目创建独立的媒体目录
- 按日期分类存储照片和视频
- 目录结构：`/项目名称/媒体文件/YYYY-MM-DD/`

### 2. 拍照功能
- 支持高质量照片拍摄
- 自动保存到项目对应的日期目录
- 照片文件命名格式：`IMG_YYYYMMDD_HHMMSS.jpg`

### 3. 录像功能
- 支持高清视频录制
- 自动保存到项目对应的日期目录
- 视频文件命名格式：`VID_YYYYMMDD_HHMMSS.mp4`

### 4. 媒体文件数据库管理
- 自动将媒体文件信息保存到数据库
- 支持媒体文件的查询和管理
- 记录文件路径、大小、创建时间等信息

### 5. 媒体浏览功能
- 网格布局展示项目所有媒体文件
- 支持照片和视频的分类查看
- 提供存储信息统计
- 支持媒体文件搜索和筛选

### 6. 媒体详情查看
- 全屏查看照片，支持缩放和平移
- 视频播放功能
- 显示详细的文件信息
- 支持分享和删除操作

## 使用流程

1. **进入相机界面**
   - 从项目仪表板选择"拍照录像"功能
   - 系统自动检查并请求必要权限

2. **拍摄媒体**
   - 点击拍照按钮进行拍照
   - 点击录像按钮开始/停止录像
   - 媒体文件自动保存到项目目录

3. **浏览媒体**
   - 在相机界面点击媒体浏览按钮
   - 查看项目所有照片和视频
   - 支持按类型筛选和搜索

4. **查看详情**
   - 点击媒体文件进入详情页面
   - 全屏查看照片或播放视频
   - 查看文件信息，支持分享和删除

5. **文件管理**
   - 系统自动创建项目媒体目录结构
   - 媒体文件按日期分类存储
   - 文件信息自动录入数据库

## 技术实现

### 核心组件

1. **CameraManager.kt**
   - 负责媒体文件的目录管理
   - 处理文件创建、移动和删除操作

2. **CameraScreen.kt**
   - 提供相机功能的用户界面
   - 处理权限请求和相机操作

3. **CameraViewModel.kt**
   - 管理相机功能的业务逻辑
   - 协调数据库操作和文件管理

### 数据库集成

- 使用现有的 `MediaFile` 实体存储媒体文件信息
- 通过 `MediaFileRepository` 进行数据库操作
- 支持按项目查询媒体文件列表

### 权限管理

- 相机权限：`android.permission.CAMERA`
- 存储权限：`android.permission.WRITE_EXTERNAL_STORAGE`
- 媒体权限：`android.permission.READ_MEDIA_IMAGES`, `android.permission.READ_MEDIA_VIDEO`

## 文件结构

```
app/src/main/java/com/example/shuigongrizhi/
├── manager/
│   └── CameraManager.kt          # 相机文件管理器
├── ui/screen/
│   ├── CameraScreen.kt           # 相机界面
│   ├── MediaGalleryScreen.kt     # 媒体浏览界面
│   └── MediaDetailScreen.kt      # 媒体详情界面
├── ui/viewmodel/
│   ├── CameraViewModel.kt        # 相机视图模型
│   └── MediaGalleryViewModel.kt  # 媒体浏览视图模型
├── data/dao/
│   └── MediaFileDao.kt           # 媒体文件数据访问（已扩展）
├── data/repository/
│   └── MediaFileRepository.kt    # 媒体文件仓库（已扩展）
└── navigation/
    └── Navigation.kt             # 导航配置（已更新）
```

## 注意事项

1. **存储空间**：确保设备有足够的存储空间用于保存媒体文件
2. **权限授予**：必须授予相机和存储权限才能正常使用
3. **项目选择**：必须先选择项目才能进入相机功能
4. **文件安全**：媒体文件保存在应用私有目录中，确保数据安全

## 未来扩展

- 支持媒体文件编辑和标注
- 添加媒体文件云端同步
- 支持批量媒体文件操作
- 集成图像识别和AI分析功能
- 支持媒体文件导出和备份
- 添加媒体文件压缩和优化
- 支持媒体文件水印添加