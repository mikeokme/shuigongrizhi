# 天气功能故障排除指南

## 问题描述
如果您看到"获取天气信息失败: HTTP 429"错误，这表示API调用频率超过了限制。

## 解决方案

### 1. 立即解决方案
- **等待一段时间再试**：HTTP 429错误通常是临时的，等待几分钟后重新尝试
- **重启应用**：完全关闭应用后重新打开
- **检查网络连接**：确保设备连接到稳定的网络

### 2. 长期解决方案

#### 获取个人API Token
1. 访问彩云天气开发者平台：https://dashboard.caiyunapp.com/
2. 注册账号并登录
3. 创建新的应用获取API Token
4. 将新Token替换到 `ApiConfig.kt` 文件中的 `CAIYUN_API_TOKEN`

#### 减少API调用频率
- 避免频繁刷新天气信息
- 使用应用内置的缓存机制
- 不要在短时间内多次点击天气相关功能

### 3. 技术改进

#### 已实现的改进
- ✅ 添加了智能重试机制
- ✅ 针对429错误的特殊处理
- ✅ 指数退避算法减少服务器压力
- ✅ 更详细的错误信息提示

#### 重试机制说明
- 遇到429错误时自动等待并重试
- 最多重试3次
- 每次重试间隔逐渐增加
- 如果服务器返回Retry-After头，会遵循建议的等待时间

## 错误代码说明

| 错误代码 | 含义 | 解决方案 |
|---------|------|----------|
| HTTP 429 | API调用频率超限 | 等待后重试，或获取个人Token |
| HTTP 401 | API密钥无效 | 检查Token配置 |
| HTTP 403 | 权限不足 | 检查账户状态 |
| HTTP 404 | 资源不存在 | 检查API地址配置 |
| HTTP 5xx | 服务器错误 | 稍后重试 |

## 预防措施

1. **合理使用频率**：不要在短时间内频繁调用天气API
2. **缓存策略**：应用会自动缓存天气数据，避免重复请求
3. **网络检查**：确保网络连接稳定
4. **Token管理**：定期检查API Token的有效性和配额

## 联系支持

如果问题持续存在，请：
1. 检查彩云天气服务状态
2. 确认API Token配置正确
3. 查看应用日志获取更详细的错误信息

---

**注意**：当前使用的是演示Token，有较严格的调用限制。建议获取个人Token以获得更好的使用体验。